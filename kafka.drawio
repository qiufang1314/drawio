<mxfile host="app.diagrams.net" modified="2023-02-27T10:51:49.702Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.3 Safari/605.1.15" etag="4Hm4pmz_6iP96nb_axZH" version="20.8.20" type="github">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="Page-1">
    <mxGraphModel dx="1021" dy="3035" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="u2IP8yDeRJX2FojSlETn-0" value="1) &amp;nbsp;规范（命名，partition 数量，参数）&lt;br&gt;2）项目资源使用报表&lt;br&gt;3）现有集群资源评估（broker 数量）&lt;br&gt;4）kafak 升级" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="20" y="-80" width="490" height="190" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-1" value="HBase&lt;br&gt;1）CDC/RTS&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	1. 1 Hadoop, 2 HBase cluster&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	pros:  集群资源完全隔离&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	cons:  无法使用cdh管理&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	2. 1 Hadoop, 1 HBase cluster, RegionServer Group&lt;br&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	pros：&lt;br/&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;cdh管理方便&lt;br/&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	充分利用集成资源&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br/&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	&lt;span style=&quot;white-space: pre;&quot;&gt;	cons：HMaster共用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;	3. 2Hadoop, 2 Hbase cluster&lt;/span&gt;&lt;br&gt;&lt;br&gt;2) monitor" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="20" y="310" width="590" height="320" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.558;entryY=-0.033;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=16;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="u2IP8yDeRJX2FojSlETn-2" target="u2IP8yDeRJX2FojSlETn-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=16;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="WIyWlLk6GJQsqaUBKTNV-1" source="u2IP8yDeRJX2FojSlETn-2" target="u2IP8yDeRJX2FojSlETn-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-2" value="HMaster" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="283" y="830" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-3" value="" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="40" y="948" width="250" height="130" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-5" value="RTS Table" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="60" y="998" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-6" value="RegionGroup-RTS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="60" y="948" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-7" value="RTS Table" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="170" y="998" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-9" value="" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="390" y="948" width="250" height="130" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-10" value="CDC Table" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="410" y="998" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-11" value="RegionGroup-CDC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="410" y="948" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-12" value="CDC Table" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;hachureGap=4;jiggle=2;curveFitting=1;fontFamily=Architects Daughter;fontSource=https%3A%2F%2Ffonts.googleapis.com%2Fcss%3Ffamily%3DArchitects%2BDaughter;fontSize=20;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="520" y="998" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-18" value="Region Server Group Step&lt;br&gt;1）配置hbase-site.xml&lt;br&gt;2) hbase shell, 添加分组&lt;br&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp;   &lt;/span&gt;add_rsgroup &#39;rts&#39;&lt;br&gt;&lt;span style=&quot;&quot;&gt;&amp;nbsp; &lt;/span&gt;add_rsgroup &#39;cdc&#39;&lt;br&gt;3)&amp;nbsp;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="760" y="290" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-19" value="&lt;div&gt;&amp;nbsp; &amp;lt;property&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;lt;name&amp;gt;hbase.coprocessor.master.classes&amp;lt;/name&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;lt;value&amp;gt;org.apache.hadoop.hbase.rsgroup.RSGroupAdminEndpoint&amp;lt;/value&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;lt;/property&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;lt;property&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;lt;name&amp;gt;hbase.master.loadbalancer.class&amp;lt;/name&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;lt;value&amp;gt;org.apache.hadoop.hbase.rsgroup.RSGroupBasedLoadBalancer&amp;lt;/value&amp;gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;lt;/property&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1330" y="150" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-21" value="1) &amp;nbsp;规范（命名，partition 数量，参数）&lt;br&gt;&amp;lt;application&amp;gt;.[bu].&amp;lt;layer&amp;gt;.&amp;lt;domain&amp;gt;.&amp;lt;subdomain&amp;gt;&lt;br&gt;&lt;br&gt;layer: [raw|processing|processed]&lt;br&gt;&lt;br&gt;partition数量规范：msg num，msg size，pod，producer，consumer&lt;br&gt;&lt;br&gt;一般来说生产消息不会是应用的瓶颈，就只从consumer角度考虑&lt;br&gt;&lt;br&gt;方案一：&lt;br&gt;maxConsumerQps = max(consumer records)/s &amp;nbsp;: 峰值，2-8原则&lt;br&gt;&lt;br&gt;avgPodConsuemrQps = avg consumer qps(pod)，topic一个partition压测&lt;br&gt;&lt;br&gt;partitionNum = maxConsumerQps /&amp;nbsp;avgPodConsuemrQps 取2的整数&lt;br&gt;&lt;br&gt;partitionNum = max(pod,&amp;nbsp;partitionNum)&lt;br&gt;&lt;br&gt;&lt;br&gt;方案二：&lt;br&gt;simple strategy:&lt;br&gt;minPartition= pod num * consumer concurrency&lt;br&gt;&lt;br&gt;方案三：&lt;br&gt;linux produce, consumer size, record&lt;br&gt;&lt;br&gt;&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="490" y="-1180" width="765" height="530" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-22" value="评估broker&lt;br&gt;&lt;br&gt;brokers = replicas &amp;nbsp;/ 4000&lt;br&gt;&lt;br&gt;cpu, mem&lt;br&gt;&lt;br&gt;threads:&amp;nbsp;&lt;br&gt;&lt;br&gt;mem:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="480" y="-520" width="500" height="280" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-23" value="kafka 升级&lt;br&gt;目标，解决roll restart 数据丢失，&lt;br&gt;&lt;br&gt;2.3.2性能优化，zk版本&lt;br&gt;didi 2.5.1&lt;br&gt;3.0??&lt;br&gt;&lt;br&gt;partition 数量不均衡， 限流进行partition数据迁移&lt;br&gt;\&lt;br&gt;&lt;br&gt;新启动集群，应用迁移" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="470" y="-230" width="500" height="195" as="geometry" />
        </mxCell>
        <mxCell id="u2IP8yDeRJX2FojSlETn-24" value="partition 数量缩减&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=20;fontFamily=Architects Daughter;" vertex="1" parent="WIyWlLk6GJQsqaUBKTNV-1">
          <mxGeometry x="1050" y="-220" width="500" height="195" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
